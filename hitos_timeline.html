<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenador PME e IA - SLEP Valle Diguill√≠n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .gradient-text { background: linear-gradient(90deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hito-row { transition: all 0.3s ease; }
        .hito-row:hover { transform: scale(1.01); background: rgba(51, 65, 85, 0.5); }
        .formula-tag { @apply px-2 py-0.5 rounded text-[10px] font-bold uppercase; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Header con Contexto Territorial -->
    <header class="p-6 border-b border-slate-700 bg-slate-900/80 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-bold gradient-text">Laboratorio de Redacci√≥n PME + IA</h1>
                <p class="text-xs text-slate-400">Escuela de Liderazgo ‚Ä¢ SLEP Valle Diguill√≠n</p>
            </div>
            <div class="flex gap-2">
                <span class="px-3 py-1 bg-green-500/10 border border-green-500/50 text-green-400 rounded-full text-xs font-semibold">Aprendizaje Activo</span>
                <span class="px-3 py-1 bg-blue-500/10 border border-blue-500/50 text-blue-400 rounded-full text-xs font-semibold">Normativa PME</span>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 mt-6">
        
        <!-- Panel de Aprendizaje: La F√≥rmula del √âxito -->
        <section class="mb-8">
            <h2 class="text-sm font-bold text-slate-400 mb-4 uppercase tracking-widest">P√≠ldora de Aprendizaje: Estructura de Acciones</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                <div class="glass-card p-3 rounded-xl border-t-2 border-blue-500">
                    <span class="formula-tag bg-blue-500/20 text-blue-400">1. Qu√©</span>
                    <p class="text-[11px] mt-1 text-slate-300">Acci√≥n (Verbo infinitivo).</p>
                </div>
                <div class="glass-card p-3 rounded-xl border-t-2 border-purple-500">
                    <span class="formula-tag bg-purple-500/20 text-purple-400">2. C√≥mo</span>
                    <p class="text-[11px] mt-1 text-slate-300">Procedimiento t√©cnico.</p>
                </div>
                <div class="glass-card p-3 rounded-xl border-t-2 border-emerald-500">
                    <span class="formula-tag bg-emerald-500/20 text-emerald-400">3. Cu√°ndo</span>
                    <p class="text-[11px] mt-1 text-slate-300">Fechas e hitos.</p>
                </div>
                <div class="glass-card p-3 rounded-xl border-t-2 border-amber-500">
                    <span class="formula-tag bg-amber-500/20 text-amber-400">4. Qui√©nes</span>
                    <p class="text-[11px] mt-1 text-slate-300">Responsables/Actores.</p>
                </div>
                <div class="glass-card p-3 rounded-xl border-t-2 border-rose-500">
                    <span class="formula-tag bg-rose-500/20 text-rose-400">5. Para qu√©</span>
                    <p class="text-[11px] mt-1 text-slate-300">Sentido pedag√≥gico.</p>
                </div>
            </div>
        </section>

        <!-- Contenedor Principal -->
        <div class="glass-card rounded-2xl shadow-2xl overflow-hidden">
            <div class="p-6 border-b border-slate-700 bg-slate-800/50 flex flex-wrap justify-between items-center gap-4">
                <div class="flex gap-2">
                    <button onclick="addHito()" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-lg font-bold transition flex items-center shadow-lg shadow-blue-900/40">
                        <span class="mr-2 text-xl">+</span> Crear Acci√≥n PME
                    </button>
                    <button onclick="exportar()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Exportar a Texto
                    </button>
                </div>
                <div class="flex items-center gap-4">
                    <div id="progress-bar-container" class="hidden md:flex flex-col items-end">
                        <div class="text-[10px] text-slate-400 uppercase font-bold mb-1">Calidad T√©cnica Global</div>
                        <div class="w-48 h-2 bg-slate-700 rounded-full overflow-hidden">
                            <div id="total-progress" class="h-full bg-gradient-to-r from-blue-500 to-emerald-500 transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="list" class="p-6 space-y-6 min-h-[350px]">
                <!-- Estado Vac√≠o Did√°ctico -->
                <div id="empty-state" class="text-center py-16">
                    <div class="text-6xl mb-4 grayscale opacity-30">‚úçÔ∏è</div>
                    <h3 class="text-xl font-bold text-slate-400">¬°Comencemos la pr√°ctica!</h3>
                    <p class="text-slate-500 max-w-sm mx-auto mt-2">A√±ade una acci√≥n para empezar a entrenar tu redacci√≥n t√©cnica siguiendo la normativa SEP.</p>
                </div>
            </div>

            <div class="p-4 bg-slate-950/60 border-t border-slate-700">
                <div id="msg" class="flex items-center gap-2 text-sm"></div>
            </div>
        </div>

        <!-- El Entrenador de IA -->
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card p-6 rounded-2xl border-2 border-dashed border-indigo-500/30">
                <h2 class="text-lg font-bold text-indigo-400 mb-3 flex items-center">
                    <span class="mr-2">‚ö°</span> Paso 1: Generar Prompt Cr√≠tico
                </h2>
                <p class="text-xs text-slate-400 mb-4">Esta instrucci√≥n obliga a la IA a auditar tu texto bajo los est√°ndares del SLEP.</p>
                <div class="bg-black/60 p-4 rounded-xl font-mono text-xs text-indigo-300 border border-indigo-500/20 relative group">
                    <code id="prompt-output" class="leading-relaxed">
                        Cargando acciones para an√°lisis...
                    </code>
                    <button onclick="copyPrompt()" class="absolute top-2 right-2 bg-indigo-500 hover:bg-indigo-400 text-white px-2 py-1 rounded text-[10px] transition font-bold shadow-lg">Copiar</button>
                </div>
            </div>

            <div class="glass-card p-6 rounded-2xl bg-indigo-900/10 border border-indigo-500/20">
                <h2 class="text-lg font-bold text-indigo-300 mb-3 flex items-center">
                    <span class="mr-2">üí°</span> Paso 2: Tutor√≠a IA
                </h2>
                <p class="text-xs text-slate-300 mb-4">Pega el prompt copiado en tu IA y ella te dir√°:</p>
                <ul class="text-xs space-y-2 text-slate-400">
                    <li class="flex items-start gap-2 italic">
                        <span class="text-emerald-500">‚úî</span> "¬øTu 'Para qu√©' realmente tributa a la mejora o es solo cumplimiento?"
                    </li>
                    <li class="flex items-start gap-2 italic">
                        <span class="text-emerald-500">‚úî</span> "¬øEst√°s asignando responsables claros para la rendici√≥n?"
                    </li>
                    <li class="flex items-start gap-2 italic">
                        <span class="text-emerald-500">‚úî</span> "¬øEl 'Cu√°ndo' tiene hitos realistas para el monitoreo?"
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        let hitoCount = 0;

        function addHito() {
            document.getElementById('empty-state').style.display = 'none';
            const wrap = document.getElementById('list');
            const hitoId = Date.now();
            const card = document.createElement('div');
            card.className = 'hito-row glass-card p-5 rounded-xl border border-slate-700/50 bg-slate-800/20 relative overflow-hidden';
            card.id = `hito-${hitoId}`;
            
            card.innerHTML = `
                <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-start">
                    <div class="md:col-span-3">
                        <label class="block text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1">Fecha de Inicio (PME)</label>
                        <input type="date" class="d w-full bg-slate-900 border border-slate-700 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition" onchange="validar()">
                    </div>
                    <div class="md:col-span-7">
                        <div class="flex justify-between items-center mb-1">
                            <label class="block text-[10px] uppercase tracking-wider text-slate-500 font-bold">Redacci√≥n de la Acci√≥n (Estructura Normativa)</label>
                            <button onclick="templateText(${hitoId})" class="text-[9px] text-indigo-400 hover:text-indigo-300 font-bold uppercase underline">Usar Plantilla Completa</button>
                        </div>
                        <textarea class="t w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none transition min-h-[100px]" 
                                  placeholder="Redacta considerando: Qu√©, C√≥mo, Cu√°ndo, Qui√©nes y Para qu√©..." 
                                  oninput="updateUI(${hitoId})"></textarea>
                        
                        <!-- Mini Check de Calidad por Hito -->
                        <div class="flex gap-2 mt-2" id="check-${hitoId}">
                            <span class="text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600 q-que">Qu√©</span>
                            <span class="text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600 q-como">C√≥mo</span>
                            <span class="text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600 q-cuando">Cu√°ndo</span>
                            <span class="text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600 q-quienes">Qui√©nes</span>
                            <span class="text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600 q-para">Para qu√©</span>
                        </div>
                    </div>
                    <div class="md:col-span-2 flex flex-col gap-2">
                         <label class="block text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1">Dimensi√≥n</label>
                         <select class="category w-full bg-slate-900 border border-slate-700 rounded-lg p-2.5 text-sm">
                            <option value="Liderazgo">Liderazgo</option>
                            <option value="Pedagogica">G. Pedag√≥gica</option>
                            <option value="Convivencia">Convivencia</option>
                            <option value="Recursos">G. Recursos</option>
                        </select>
                        <button onclick="removeHito(${hitoId})" class="mt-2 text-slate-500 hover:text-red-400 text-xs flex items-center justify-center gap-1 transition">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            Eliminar
                        </button>
                    </div>
                </div>
            `;
            wrap.appendChild(card);
            hitoCount++;
            updateStats();
        }

        function templateText(id) {
            const area = document.querySelector(`#hito-${id} textarea`);
            area.value = "[QU√â]: \n[C√ìMO]: \n[CU√ÅNDO]: \n[QUI√âNES]: \n[PARA QU√â]: ";
            area.focus();
            updateUI(id);
        }

        function removeHito(id) {
            document.getElementById(`hito-${id}`).remove();
            hitoCount--;
            updateStats();
            if(hitoCount === 0) document.getElementById('empty-state').style.display = 'block';
            validar();
        }

        function updateUI(id) {
            const val = document.querySelector(`#hito-${id} textarea`).value.toLowerCase();
            const checks = document.getElementById(`check-${id}`);
            
            // L√≥gica de detecci√≥n de estructura normativa
            const hasQue = val.includes('qu√©') || (val.length > 5 && val.split(' ').length > 2);
            const hasComo = val.includes('c√≥mo') || val.includes('mediante') || val.includes('a trav√©s') || val.includes('procedimiento');
            const hasCuando = val.includes('cu√°ndo') || val.includes('fecha') || val.includes('mes') || val.includes('hitos') || val.includes('periodo');
            const hasQuienes = val.includes('qui√©nes') || val.includes('docentes') || val.includes('equipo') || val.includes('responsable');
            const hasPara = val.includes('para') || val.includes('sentido') || val.includes('fin') || val.includes('objetivo');

            updateCheck(checks.querySelector('.q-que'), hasQue, 'border-blue-500 text-blue-400');
            updateCheck(checks.querySelector('.q-como'), hasComo, 'border-purple-500 text-purple-400');
            updateCheck(checks.querySelector('.q-cuando'), hasCuando, 'border-emerald-500 text-emerald-400');
            updateCheck(checks.querySelector('.q-quienes'), hasQuienes, 'border-amber-500 text-amber-400');
            updateCheck(checks.querySelector('.q-para'), hasPara, 'border-rose-500 text-rose-400');

            updateStats();
        }

        function updateCheck(el, condition, classes) {
            if(condition) {
                el.className = `text-[9px] px-1.5 py-0.5 rounded font-bold border ${classes}`;
            } else {
                el.className = 'text-[9px] px-1.5 py-0.5 rounded border border-slate-700 text-slate-600';
            }
        }

        function updateStats() {
            const totalText = [...document.querySelectorAll('.t')].map(e => e.value).join(" ");
            
            // Barra de progreso basada en el an√°lisis de las palabras clave estructurales
            const keywords = ['qu√©', 'c√≥mo', 'cu√°ndo', 'qui√©nes', 'para', 'mediante', 'responsable', 'impacto', 'hito'];
            let found = 0;
            keywords.forEach(k => { if(totalText.toLowerCase().includes(k)) found++; });
            
            const progress = hitoCount > 0 ? (found / keywords.length) * 100 : 0;
            document.getElementById('total-progress').style.width = `${Math.min(progress, 100)}%`;
            
            updatePrompt();
        }

        function validar() {
            const inputs = [...document.querySelectorAll('.d')].filter(e => e.value);
            const dates = inputs.map(e => new Date(e.value));
            let sorted = true;
            for (let i = 1; i < dates.length; i++) {
                if (dates[i] < dates[i - 1]) sorted = false;
            }

            const msg = document.getElementById('msg');
            if (dates.length < 2) {
                msg.innerHTML = '';
            } else if (sorted) {
                msg.innerHTML = '<span class="text-emerald-400 flex items-center">‚úî Cronolog√≠a de implementaci√≥n v√°lida para el ciclo escolar.</span>';
            } else {
                msg.innerHTML = '<span class="text-rose-400 flex items-center">‚ö† Advertencia: Las fechas de inicio no siguen el flujo l√≥gico del PME.</span>';
            }
        }

        function updatePrompt() {
            const actions = [...document.querySelectorAll('.t')].map(e => e.value).filter(v => v.length > 5);
            const promptBox = document.getElementById('prompt-output');
            
            if(actions.length === 0) {
                promptBox.innerText = "A√±ade acciones para generar el prompt de tutor√≠a...";
                return;
            }

            const basePrompt = `Act√∫a como un Asesor T√©cnico Pedag√≥gico (ATP) experto en mejora continua y normativa SEP. 
Analiza estas acciones de PME del SLEP Valle Diguill√≠n: 
"${actions.join(' | ')}"

Por cada acci√≥n, eval√∫a estrictamente:
1. ¬øDefine el QU√â (verbo) de forma t√©cnica e innovadora?
2. ¬øExplica el C√ìMO (procedimiento) para que sea replicable por el equipo?
3. ¬øEstablece el CU√ÅNDO (temporalidad/hitos) de forma clara?
4. ¬øDesigna QUI√âNES participan y qui√©n rinde cuenta?
5. ¬øEl PARA QU√â demuestra un impacto pedag√≥gico real alineado al Modelo de Desarrollo de Capacidades?

Si falta alg√∫n elemento, ind√≠camelo y dame una propuesta mejorada que cumpla con el Manual de Rendici√≥n de Cuentas 2025 y instale capacidades en el equipo directivo.`;

            promptBox.innerText = basePrompt;
        }

        function copyPrompt() {
            const text = document.getElementById('prompt-output').innerText;
            if(text.includes("A√±ade acciones")) return;
            
            navigator.clipboard.writeText(text);
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "COPIADO";
            btn.classList.replace('bg-indigo-500', 'bg-emerald-500');
            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.replace('bg-emerald-500', 'bg-indigo-500');
            }, 2000);
        }

        function exportar() {
            const ts = [...document.querySelectorAll('.t')];
            const ds = [...document.querySelectorAll('.d')];
            const cats = [...document.querySelectorAll('.category')];
            
            if (ts.length === 0) return;
            
            let txt = 'INFORME DE ACCIONES PME - PROPUESTA T√âCNICA ESTRUCTURADA\n';
            txt += 'Territorio: SLEP Valle Diguill√≠n\n';
            txt += '------------------------------------------\n\n';
            
            for (let i = 0; i < ts.length; i++) {
                txt += `ACCI√ìN ${i+1} [Categor√≠a: ${cats[i].value}]\n`;
                txt += `FECHA DE INICIO: ${ds[i].value || 'POR DEFINIR'}\n`;
                txt += `CONTENIDO ESTRUCTURADO:\n${ts[i].value}\n`;
                txt += `------------------------------------------\n`;
            }
            
            const blob = new Blob([txt], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const el = document.createElement('a');
            el.href = url;
            el.download = `Acciones_PME_Estructuradas_${new Date().toISOString().slice(0,10)}.txt`;
            el.click();
        }
    </script>
</body>
</html>