<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Escape EID ¬∑ Desaf√≠o de Est√°ndares</title>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- √çconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --bg: #04080f; --surface: #080f1e; --surface2: #0c1828; --border: #152236;
            --text: #ddeeff; --muted: #4a7a9b;
            --red: #ff3a3a; --orange: #ff8c00; --yellow: #ffd700;
            --green: #00ff9d; --blue: #00d4ff; --purple: #a855f7;
            --neon: #deff9a;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Syne', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

        /* Scanline visual effect */
        body::after {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.03) 2px, rgba(0,0,0,.03) 4px);
            pointer-events: none; z-index: 9999;
        }

        #cvs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; opacity: .35; }

        /* Ajuste Responsivo iPad/Tablet */
        .shell {
            position: relative; z-index: 1; max-width: 1100px; margin: 0 auto;
            padding: 0 40px 80px 180px; /* Despeje cr√≠tico para el √≠ndice lateral */
        }

        @media(max-width: 1024px) {
            .shell { padding: 0 20px 60px 120px; }
            .nav-terminal span { display: none; } /* Oculta texto en iPad para no chocar */
        }

        @media(max-width: 640px) {
            .shell { padding: 0 15px 40px 80px; }
        }

        /* ‚îÄ‚îÄ NAVEGACI√ìN TERMINAL ‚îÄ‚îÄ */
        .nav-terminal { position: fixed; left: 20px; top: 50%; transform: translateY(-50%); z-index: 100; font-family: 'Space Mono', monospace; font-size: 10px; }
        .nav-item { margin: 15px 0; cursor: pointer; opacity: 0.3; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-item.active { opacity: 1; color: var(--neon); }
        .nav-dot { width: 10px; height: 10px; border: 1px solid #fff; border-radius: 2px; }
        .active .nav-dot { background: var(--neon); border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }

        /* ‚îÄ‚îÄ INTERFAZ ‚îÄ‚îÄ */
        .glass { background: rgba(8, 15, 30, 0.8); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 18px; }
        .btn-action { background: linear-gradient(135deg, #7f0000, #cc0000); border: 1px solid var(--red); box-shadow: 0 0 20px rgba(255,58,58,0.3); transition: 0.3s; }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(255,58,58,0.5); }

        .opt-card { background: var(--surface2); border: 1px solid var(--border); transition: 0.2s; cursor: pointer; display: flex; align-items: flex-start; gap: 12px; }
        .opt-card:not(.disabled):hover { border-color: var(--blue); background: rgba(0, 212, 255, 0.05); transform: translateX(8px); }
        .opt-card.correct { border-color: var(--green) !important; background: rgba(0, 255, 157, 0.05) !important; }
        .opt-card.wrong { border-color: var(--red) !important; background: rgba(255, 58, 58, 0.05) !important; opacity: 0.6; }
        .opt-card.disabled { cursor: default; }

        .badge-eid { background: rgba(0, 212, 255, 0.1); border: 1px solid var(--blue); color: var(--blue); font-size: 10px; padding: 2px 8px; border-radius: 4px; font-weight: bold; }

        .fade-in { animation: fadeIn 0.4s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .text-neon { color: var(--neon); }
    </style>
</head>
<body>
<canvas id="cvs"></canvas>

<!-- NAVEGACI√ìN -->
<nav class="nav-terminal">
    <div class="nav-item active" id="nav-0"><div class="nav-dot"></div> <span>00_ACCESO</span></div>
    <div class="nav-item" id="nav-1"><div class="nav-dot"></div> <span>01_DIMENSI√ìN</span></div>
    <div class="nav-item" id="nav-2"><div class="nav-dot"></div> <span>02_DESAF√çO</span></div>
    <div class="nav-item" id="nav-3"><div class="nav-dot"></div> <span>03_RESULTADOS</span></div>
</nav>

<div class="shell">

    <!-- ‚ïê‚ïê SCREEN 0: INTRO ‚ïê‚ïê -->
    <div id="screen-intro" class="min-h-screen flex flex-col justify-center fade-in">
        <span class="text-red-500 font-mono text-sm tracking-[5px] mb-4">SISTEMA RESTRINGIDO ¬∑ EID v.2026</span>
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-black mb-6 leading-none">ESCAPE <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500">INDICATIVO</span></h1>
        <p class="text-lg md:text-xl text-slate-400 max-w-2xl mb-10 leading-relaxed italic">Est√°s atrapado en la inercia administrativa. Solo el dominio de los est√°ndares EID te permitir√° abrir los candados y liderar la mejora en el Valle Diguill√≠n.</p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-3xl">
            <button onclick="selectDimension('Liderazgo')" class="glass p-6 text-left hover:border-blue-400 transition-all group">
                <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">üèõÔ∏è</div>
                <h3 class="font-bold text-blue-400">Liderazgo</h3>
                <p class="text-xs text-slate-500 mt-1">Conducci√≥n, visi√≥n estrat√©gica y metas.</p>
            </button>
            <button onclick="selectDimension('Gesti√≥n Pedag√≥gica')" class="glass p-6 text-left hover:border-green-400 transition-all group">
                <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">üìö</div>
                <h3 class="font-bold text-green-400">Gesti√≥n Pedag√≥gica</h3>
                <p class="text-xs text-slate-500 mt-1">Curr√≠culum, ense√±anza y resultados.</p>
            </button>
            <button onclick="selectDimension('Formaci√≥n y Convivencia')" class="glass p-6 text-left hover:border-purple-400 transition-all group">
                <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">ü§ù</div>
                <h3 class="font-bold text-purple-400">Formaci√≥n y Convivencia</h3>
                <p class="text-xs text-slate-500 mt-1">Clima, inclusi√≥n y participaci√≥n.</p>
            </button>
            <button onclick="selectDimension('Gesti√≥n de Recursos')" class="glass p-6 text-left hover:border-orange-400 transition-all group">
                <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">‚öôÔ∏è</div>
                <h3 class="font-bold text-orange-400">Gesti√≥n de Recursos</h3>
                <p class="text-xs text-slate-500 mt-1">SEP, RRHH e infraestructura.</p>
            </button>
        </div>
    </div>

    <!-- ‚ïê‚ïê SCREEN 1: GAME ‚ïê‚ïê -->
    <div id="screen-game" class="hidden min-h-screen pt-20">
        <header class="flex justify-between items-center mb-10 pb-4 border-b border-white/10">
            <div>
                <span class="text-[10px] text-slate-500 uppercase tracking-widest">Dimensi√≥n Actual</span>
                <h2 id="display-dim" class="text-2xl font-bold text-neon">---</h2>
                <p id="display-level" class="text-[10px] text-slate-500 uppercase tracking-widest mt-1">Nivel 1</p>
            </div>
            <div class="text-right">
                <span class="text-[10px] text-slate-500 uppercase tracking-widest">Progreso Misi√≥n</span>
                <div id="progress-dots" class="flex gap-2 mt-1">
                    <!-- Dots din√°micos -->
                </div>
            </div>
        </header>

        <div id="challenge-container" class="space-y-8 fade-in">
            <!-- Pregunta din√°mica -->
        </div>
    </div>

    <!-- ‚ïê‚ïê SCREEN 2: DEBRIEF ‚ïê‚ïê -->
    <div id="screen-debrief" class="hidden min-h-screen py-20 fade-in">
        <div class="text-center mb-12">
            <h2 class="text-5xl font-black mb-4">MISI√ìN <span id="mission-status" class="text-green-400">COMPLETADA</span></h2>
            <p class="text-slate-400">Has procesado los datos t√©cnicos del establecimiento.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="glass p-8 border-l-4 border-neon">
                <h3 class="text-xl font-bold mb-4">An√°lisis de Pericia</h3>
                <p id="pericia-feedback" class="text-slate-300 leading-relaxed"></p>
            </div>
            <div class="glass p-8 border-l-4 border-blue-400">
                <h3 class="text-xl font-bold mb-4 italic">Reflexi√≥n MDC</h3>
                <p class="text-slate-300">"El asesor no entrega el plan hecho; facilita que el director encuentre el est√°ndar mediante la pregunta."</p>
                <div class="mt-6 flex flex-wrap gap-2">
                    <span class="badge-eid">#InstalarCapacidades</span>
                    <span class="badge-eid">#LiderazgoDistribuido</span>
                </div>
            </div>
        </div>

        <div class="flex justify-center gap-4">
            <button onclick="resetGame()" class="btn-action px-10 py-4 rounded-full font-bold uppercase tracking-widest text-white">Nuevos Desaf√≠os ‚Ü∫</button>
        </div>
    </div>

</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BANCO DE CASOS (BASE, NIVEL 1)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const MASTER_BANK = {
    "Liderazgo": [
        {
            escuela: "Liceo Bicentenario 'El Caleuche'",
            problema: "El equipo directivo tiene un PME con 45 acciones, pero el 80% de la comunidad escolar no conoce el PEI ni los sellos educativos.",
            pregunta: "¬øQu√© est√°ndar del EID se est√° vulnerando prioritariamente?",
            opciones: [
                "1.1 Visi√≥n estrat√©gica y compartida",
                "2.2 Monitoreo y seguimiento del PME",
                "10.5 Clima laboral positivo",
                "3.1 Uso de datos educativos"
            ],
            ok: 0,
            feedback: "El est√°ndar 1.1 exige que la visi√≥n y los sellos del PEI sean conocidos y compartidos por toda la comunidad educativa."
        },
        {
            escuela: "Escuela B√°sica 'La Pincoya'",
            problema: "El Director toma decisiones presupuestarias solo, sin informar al Consejo Escolar ni considerar las metas pedag√≥gicas del a√±o.",
            pregunta: "Asocia esta falta de gesti√≥n con la subdimensi√≥n correcta:",
            opciones: [
                "Liderazgo del Director",
                "Planificaci√≥n y gesti√≥n de resultados",
                "Informaci√≥n y an√°lisis de resultados",
                "Gesti√≥n de recursos financieros"
            ],
            ok: 1,
            feedback: "La subdimensi√≥n Planificaci√≥n y gesti√≥n estrat√©gica exige que los recursos se alineen con metas pedag√≥gicas y se gestionen con participaci√≥n."
        },
        {
            escuela: "Colegio Polivalente 'Moai'",
            problema: "No existen registros de actas de las reuniones de equipo directivo, por lo que no se puede realizar seguimiento a los acuerdos tomados.",
            pregunta: "¬øCu√°l es el est√°ndar de desempe√±o afectado?",
            opciones: [
                "1.3 Conducci√≥n de la escuela e instalaci√≥n de pr√°cticas",
                "4.1 Cobertura curricular",
                "11.2 Presupuesto y sustentabilidad",
                "1.4 Responsabilizaci√≥n y rendici√≥n de cuentas"
            ],
            ok: 0,
            feedback: "El est√°ndar 1.3 exige instalar rutinas y sistemas de registro que permitan dar continuidad y seguimiento a las decisiones."
        },
        {
            escuela: "Liceo Industrial 'Araucaria'",
            problema: "El director asume todas las tareas administrativas y no delega responsabilidades, sobrecarg√°ndose y retrasando procesos clave.",
            pregunta: "¬øQu√© est√°ndar de Liderazgo se requiere fortalecer?",
            opciones: [
                "1.2 Desarrollo de capacidades y liderazgo distribuido",
                "3.1 Cultura de uso de datos",
                "2.1 Dise√±o del PME",
                "10.1 Gesti√≥n del personal"
            ],
            ok: 0,
            feedback: "El est√°ndar 1.2 plantea que el director debe desarrollar capacidades y distribuir el liderazgo para sostener la mejora."
        },
        {
            escuela: "Escuela 'Valle del Sol'",
            problema: "Se realizan evaluaciones SIMCE y DIA, pero los resultados solo se archivan y nunca se discuten en el Consejo de Profesores.",
            pregunta: "¬øQu√© pr√°ctica directiva falta por consolidar?",
            opciones: [
                "2.2 Monitoreo de metas",
                "3.1 Uso de datos para la toma de decisiones",
                "4.3 Evaluaci√≥n de aprendizajes",
                "1.1 Difusi√≥n del PEI"
            ],
            ok: 1,
            feedback: "El est√°ndar 3.1 exige una cultura de uso de datos: analizar resultados en equipo para orientar decisiones pedag√≥gicas."
        }
    ],
    "Gesti√≥n Pedag√≥gica": [
        {
            escuela: "Liceo 'Mano de Piedra' Dur√°n",
            problema: "Los docentes entregan planificaciones, pero la UTP no realiza observaciones de aula ni entrega retroalimentaci√≥n sistem√°tica.",
            pregunta: "Identifica el est√°ndar vulnerado seg√∫n el EID:",
            opciones: [
                "4.2 Planificaci√≥n de la ense√±anza",
                "5.1 Estrategias de ense√±anza",
                "5.5 Acompa√±amiento al aula y retroalimentaci√≥n",
                "6.1 Apoyo a NEE"
            ],
            ok: 2,
            feedback: "El est√°ndar 5.5 indica que el equipo directivo debe observar clases y retroalimentar sistem√°ticamente para mejorar la ense√±anza."
        },
        {
            escuela: "Escuela Rural 'Condorito'",
            problema: "Los resultados DIA muestran que el 60% de los estudiantes no logra los OA en lectura, pero los docentes siguen avanzando en el libro sin ajustes.",
            pregunta: "¬øQu√© pr√°ctica de Gesti√≥n Curricular falta instalar?",
            opciones: [
                "Cobertura Curricular (4.1)",
                "Evaluaci√≥n de Aprendizajes y uso pedag√≥gico (4.3)",
                "Articulaci√≥n entre niveles (4.4)",
                "Ambiente para el aprendizaje (5.2)"
            ],
            ok: 1,
            feedback: "El est√°ndar 4.3 obliga a usar los resultados de evaluaci√≥n para ajustar la ense√±anza y remediar brechas a tiempo."
        },
        {
            escuela: "Colegio 'Los Copihues'",
            problema: "Los profesores de 8¬∞ b√°sico y 1¬∞ medio no se re√∫nen a coordinar contenidos, provocando un choque acad√©mico fuerte en los estudiantes.",
            pregunta: "¬øA qu√© est√°ndar apunta esta necesidad?",
            opciones: [
                "4.1 Implementaci√≥n curricular",
                "4.4 Articulaci√≥n curricular y transici√≥n",
                "6.3 Apoyo psicosocial",
                "5.3 Clima de aula"
            ],
            ok: 1,
            feedback: "El est√°ndar 4.4 aborda la articulaci√≥n curricular y la transici√≥n entre niveles y ciclos."
        },
        {
            escuela: "Escuela B√°sica 'El Roble'",
            problema: "El clima dentro de las salas de clase es ca√≥tico; los docentes destinan m√°s de la mitad del tiempo a intentar mantener el orden.",
            pregunta: "¬øQu√© est√°ndar de Ense√±anza se debe abordar urgentemente?",
            opciones: [
                "5.2 Ambiente y clima de aula",
                "4.2 Planificaci√≥n",
                "6.1 Estudiantes con rezago",
                "5.4 Uso del tiempo lectivo"
            ],
            ok: 0,
            feedback: "El est√°ndar 5.2 exige que los docentes generen un ambiente ordenado, respetuoso y propicio para el aprendizaje."
        },
        {
            escuela: "Liceo Art√≠stico 'Violeta'",
            problema: "En una clase de matem√°ticas, la profesora utiliza el mismo m√©todo expositivo para todos, sin considerar a estudiantes PIE.",
            pregunta: "¬øQu√© aspecto de la gesti√≥n pedag√≥gica est√° ausente?",
            opciones: [
                "4.1 Cobertura curricular",
                "6.2 Orientaci√≥n vocacional",
                "5.1 Estrategias de ense√±anza diversificadas",
                "4.3 Sistemas de evaluaci√≥n"
            ],
            ok: 2,
            feedback: "El est√°ndar 5.1 demanda estrategias diversificadas (DUA) para responder a las distintas necesidades de los estudiantes."
        }
    ],
    "Formaci√≥n y Convivencia": [
        {
            escuela: "Instituto 'Don Chuma'",
            problema: "Se aplican sanciones por disciplina, pero el colegio no cuenta con un Plan de Formaci√≥n Ciudadana ni promueve valores transversales.",
            pregunta: "Asocia el problema a la subdimensi√≥n EID correspondiente:",
            opciones: [
                "Convivencia Escolar",
                "Formaci√≥n integral y val√≥rica",
                "Participaci√≥n y vida democr√°tica",
                "Apoyo al desarrollo estudiantil"
            ],
            ok: 1,
            feedback: "La subdimensi√≥n Formaci√≥n integra est√°ndares sobre formaci√≥n √©tica, ciudadana y val√≥rica alineada al PEI."
        },
        {
            escuela: "Liceo 'La Tirana'",
            problema: "Ocurri√≥ un caso grave de ciberacoso y los docentes no supieron qu√© hacer porque el Protocolo de Actuaci√≥n lleva 5 a√±os sin actualizarse.",
            pregunta: "¬øQu√© est√°ndar se encuentra en nivel incipiente?",
            opciones: [
                "8.1 Gesti√≥n de la convivencia escolar",
                "9.1 Participaci√≥n de apoderados",
                "7.1 Desarrollo personal y social",
                "8.2 Prevenci√≥n y protocolos de actuaci√≥n"
            ],
            ok: 3,
            feedback: "El est√°ndar 8.2 exige contar con estrategias preventivas y protocolos de actuaci√≥n actualizados y conocidos."
        },
        {
            escuela: "Escuela 'Huasos de Algorta'",
            problema: "El Centro de Padres (CGPA) y el Centro de Alumnos (CCAA) existen en el papel, pero el director nunca los convoca ni toma en cuenta sus opiniones.",
            pregunta: "¬øA qu√© est√°ndar afecta esta pr√°ctica directiva?",
            opciones: [
                "9.1 Participaci√≥n de la comunidad",
                "8.1 Clima escolar",
                "7.3 Inclusi√≥n y diversidad",
                "10.2 Evaluaci√≥n del personal"
            ],
            ok: 0,
            feedback: "El est√°ndar 9.1 se√±ala que se deben generar instancias reales de participaci√≥n de todos los estamentos."
        },
        {
            escuela: "Colegio 'Norte Grande'",
            problema: "Ha aumentado la matr√≠cula de estudiantes extranjeros, pero la escuela no tiene ninguna iniciativa para integrar sus culturas o prevenir la discriminaci√≥n.",
            pregunta: "¬øQu√© est√°ndar de Formaci√≥n y Convivencia se debe movilizar?",
            opciones: [
                "7.1 H√°bitos de vida saludable",
                "8.2 Reglamentos internos",
                "7.3 Promoci√≥n de la inclusi√≥n y valoraci√≥n de la diversidad",
                "9.2 Vida democr√°tica"
            ],
            ok: 2,
            feedback: "El est√°ndar 7.3 aborda la inclusi√≥n y la valoraci√≥n de la diversidad, evitando pr√°cticas discriminatorias."
        },
        {
            escuela: "Liceo 'Sur Austral'",
            problema: "Los estudiantes de 4to medio manifiestan alta ansiedad y desmotivaci√≥n, ya que la escuela no ofrece programas de orientaci√≥n para su futuro.",
            pregunta: "¬øQu√© est√°ndar de la Dimensi√≥n de Formaci√≥n est√° d√©bil?",
            opciones: [
                "6.2 Orientaci√≥n vocacional y proyecto de vida",
                "7.2 Formaci√≥n ciudadana",
                "8.1 Normas de convivencia",
                "9.1 V√≠nculo con la familia"
            ],
            ok: 0,
            feedback: "El est√°ndar 6.2 (desde Apoyo al desarrollo) se vincula con orientar vocacionalmente y acompa√±ar el proyecto de vida."
        }
    ],
    "Gesti√≥n de Recursos": [
        {
            escuela: "Escuela 'Los Volcanes'",
            problema: "Hay tablets compradas hace 2 a√±os con fondos SEP que nunca se han usado porque no existe un protocolo de uso ni capacitaci√≥n a docentes.",
            pregunta: "¬øQu√© est√°ndar de Gesti√≥n de Recursos falla aqu√≠?",
            opciones: [
                "12.1 Infraestructura segura",
                "12.2 Gesti√≥n de recursos did√°cticos y tecnol√≥gicos",
                "12.3 Biblioteca CRA",
                "11.3 Cumplimiento normativo"
            ],
            ok: 1,
            feedback: "El est√°ndar 12.2 no solo pide adquirir recursos, sino gestionarlos para que se usen pedag√≥gicamente."
        },
        {
            escuela: "Liceo Comercial 'El Peso'",
            problema: "Al llegar diciembre, la escuela descubre que tiene el 60% de los fondos SEP sin ejecutar, arriesgando reintegros al Ministerio.",
            pregunta: "Identifica la subdimensi√≥n con problemas cr√≠ticos:",
            opciones: [
                "Gesti√≥n de personal",
                "Gesti√≥n de recursos educativos",
                "Gesti√≥n financiera y administrativa",
                "Liderazgo del sostenedor"
            ],
            ok: 2,
            feedback: "La subdimensi√≥n Gesti√≥n financiera y administrativa exige uso oportuno y planificado de los recursos como SEP."
        },
        {
            escuela: "Colegio 'Los Alerces'",
            problema: "El colegio contrat√≥ a un profesor de m√∫sica para hacer clases de matem√°ticas debido a la escasez, sin acompa√±amiento para su nivelaci√≥n.",
            pregunta: "¬øQu√© est√°ndar de Gesti√≥n de Personal se ha vulnerado?",
            opciones: [
                "10.1 Perfiles, selecci√≥n y asignaci√≥n de funciones",
                "11.1 Gesti√≥n administrativa",
                "10.4 Buen trato laboral",
                "12.1 Mantenimiento de espacios"
            ],
            ok: 0,
            feedback: "El est√°ndar 10.1 se refiere a contar con perfiles claros y asignar funciones acordes a las competencias."
        },
        {
            escuela: "Escuela B√°sica 'Desierto Florido'",
            problema: "Los docentes se quejan de que no hay instancias formales para aprender nuevas metodolog√≠as ni perfeccionamiento financiado por el colegio.",
            pregunta: "¬øA qu√© est√°ndar apunta esta demanda?",
            opciones: [
                "10.2 Evaluaci√≥n de desempe√±o",
                "10.3 Desarrollo profesional y capacitaci√≥n",
                "11.2 Presupuesto",
                "1.2 Liderazgo distribuido"
            ],
            ok: 1,
            feedback: "El est√°ndar 10.3 establece que el establecimiento debe promover y facilitar el desarrollo profesional continuo."
        },
        {
            escuela: "Instituto 'Cordillera'",
            problema: "Los ba√±os de los estudiantes tienen llaves rotas desde hace meses y las salas no cuentan con estufas en pleno invierno austral.",
            pregunta: "¬øCu√°l es el est√°ndar que el Sostenedor y Director deben resolver urgente?",
            opciones: [
                "12.2 Recursos tecnol√≥gicos",
                "11.3 Normativa laboral",
                "10.5 Clima organizacional",
                "12.1 Infraestructura, equipamiento y seguridad"
            ],
            ok: 3,
            feedback: "El est√°ndar 12.1 es clave para asegurar condiciones b√°sicas, seguras y dignas en los espacios f√≠sicos."
        }
    ]
};

/* A√±adimos una clave est√°ndar normalizada a cada caso (la alternativa correcta) */
Object.keys(MASTER_BANK).forEach(dim => {
    MASTER_BANK[dim].forEach(c => {
        c.standardKey = c.opciones[c.ok];
    });
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESCRIPTORES DE EST√ÅNDARES (NIVEL 3)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const STANDARD_DESCRIPTORS = {
    "1.1 Visi√≥n estrat√©gica y compartida": {
        pregunta: "Seg√∫n el est√°ndar 1.1, ¬øcu√°l descriptor refleja mejor una pr√°ctica instalada?",
        opciones: [
            "El PEI est√° archivado en secretar√≠a y se revisa solo para la acreditaci√≥n.",
            "La visi√≥n y sellos del PEI se comunican y se usan para orientar decisiones y proyectos.",
            "El director delega todas las decisiones en la UTP.",
            "La escuela solo prioriza resultados SIMCE por sobre otros focos."
        ],
        ok: 1
    },
    "1.3 Conducci√≥n de la escuela e instalaci√≥n de pr√°cticas": {
        pregunta: "¬øQu√© descriptor se alinea mejor con el est√°ndar 1.3?",
        opciones: [
            "Se realizan reuniones espor√°dicas sin acuerdos escritos.",
            "El director instala rutinas y registros que permiten seguimiento sistem√°tico de acuerdos.",
            "Los docentes deciden individualmente qu√© pr√°cticas aplicar.",
            "Solo el sostenedor define las prioridades de la escuela."
        ],
        ok: 1
    },
    "1.2 Desarrollo de capacidades y liderazgo distribuido": {
        pregunta: "En el est√°ndar 1.2, ¬øqu√© pr√°ctica describe mejor el liderazgo distribuido?",
        opciones: [
            "El director concentra todas las decisiones relevantes.",
            "Se crean cargos, pero sin claridad de funciones.",
            "Se conforman equipos de trabajo con responsabilidades claras y autonom√≠a progresiva.",
            "Se contrata asesor√≠a externa para reemplazar al equipo interno."
        ],
        ok: 2
    },
    "3.1 Uso de datos para la toma de decisiones": {
        pregunta: "Un descriptor propio del est√°ndar 3.1 es:",
        opciones: [
            "Aplicar evaluaciones, pero no sistematizar los resultados.",
            "Analizar resultados en equipo y tomar decisiones pedag√≥gicas en base a ellos.",
            "Publicar solo los resultados positivos en redes sociales.",
            "Guardar los informes de evaluaci√≥n en una carpeta f√≠sica."
        ],
        ok: 1
    },
    "5.5 Acompa√±amiento al aula y retroalimentaci√≥n": {
        pregunta: "¬øQu√© pr√°ctica corresponde a un descriptor del est√°ndar 5.5?",
        opciones: [
            "La UTP revisa solo las planificaciones escritas.",
            "Se aplican encuestas de satisfacci√≥n a estudiantes una vez al a√±o.",
            "La direcci√≥n observa sistem√°ticamente clases y retroalimenta a los docentes.",
            "Los docentes se autoeval√∫an sin acompa√±amiento externo."
        ],
        ok: 2
    },
    "Evaluaci√≥n de Aprendizajes y uso pedag√≥gico (4.3)": {
        pregunta: "¬øCu√°l de las siguientes acciones responde al est√°ndar 4.3?",
        opciones: [
            "Aplicar pruebas estandarizadas sin analizarlas.",
            "Revisar calificaciones solo al final de semestre.",
            "Analizar resultados de evaluaciones y ajustar la ense√±anza en funci√≥n de ellos.",
            "Registrar notas en el libro de clases puntualmente."
        ],
        ok: 2
    },
    "4.4 Articulaci√≥n curricular y transici√≥n": {
        pregunta: "En el est√°ndar 4.4, un descriptor adecuado ser√≠a:",
        opciones: [
            "Cada docente planifica sin considerar otros niveles.",
            "Se coordina entre niveles qu√© contenidos priorizar y c√≥mo apoyar la transici√≥n de los estudiantes.",
            "Se repiten las mismas unidades en 8¬∞ y 1¬∞ medio.",
            "El cambio de nivel es solo administrativo."
        ],
        ok: 1
    },
    "5.2 Ambiente y clima de aula": {
        pregunta: "¬øQu√© descriptor se alinea mejor con el est√°ndar 5.2?",
        opciones: [
            "El docente permite insultos entre estudiantes si cumplen con las tareas.",
            "Se establece un clima de respeto, normas claras y alta expectativa por el aprendizaje.",
            "Se prioriza terminar el contenido por sobre el respeto.",
            "La disciplina depende solo del inspector general."
        ],
        ok: 1
    },
    "5.1 Estrategias de ense√±anza diversificadas": {
        pregunta: "En relaci√≥n con el est√°ndar 5.1, ¬øcu√°l es un descriptor clave?",
        opciones: [
            "El docente utiliza siempre la misma explicaci√≥n magistral.",
            "El docente diversifica m√©todos y recursos seg√∫n necesidades y estilos de aprendizaje.",
            "Se proh√≠be el trabajo en grupo.",
            "Se usa solo el libro de texto oficial."
        ],
        ok: 1
    },
    "Formaci√≥n integral y val√≥rica": {
        pregunta: "Un descriptor coherente con la subdimensi√≥n Formaci√≥n integral y val√≥rica es:",
        opciones: [
            "Solo se ense√±a el curr√≠culum disciplinar.",
            "Se implementan acciones aisladas sin relaci√≥n con el PEI.",
            "Se desarrollan experiencias planificadas que promueven valores y ciudadan√≠a de forma transversal.",
            "Se delega la formaci√≥n val√≥rica exclusivamente a la familia."
        ],
        ok: 2
    },
    "8.2 Prevenci√≥n y protocolos de actuaci√≥n": {
        pregunta: "¬øQu√© evidencia se asocia al est√°ndar 8.2?",
        opciones: [
            "Existencia de un protocolo de convivencia desactualizado.",
            "Protocolos actualizados, conocidos por la comunidad y aplicados ante situaciones de riesgo.",
            "Solo sancionar seg√∫n criterio del director.",
            "Evitar hablar de conflictos para no alarmar."
        ],
        ok: 1
    },
    "9.1 Participaci√≥n de la comunidad": {
        pregunta: "Selecciona el descriptor m√°s coherente con el est√°ndar 9.1:",
        opciones: [
            "Los centros de padres y estudiantes existen solo en el papel.",
            "El director convoca y escucha activamente a los centros de padres y estudiantes en decisiones relevantes.",
            "La escuela se comunica solo por circulares impresas.",
            "Las reuniones son solo informativas."
        ],
        ok: 1
    },
    "7.3 Promoci√≥n de la inclusi√≥n y valoraci√≥n de la diversidad": {
        pregunta: "¬øQu√© acci√≥n refleja un descriptor de inclusi√≥n y diversidad (7.3)?",
        opciones: [
            "Asignar a estudiantes migrantes a cursos separados.",
            "Ignorar diferencias culturales para 'tratar a todos por igual'.",
            "Visibilizar y valorar distintas culturas en actividades, evitando la discriminaci√≥n.",
            "Expulsar a quien discrimine sin trabajar el tema."
        ],
        ok: 2
    },
    "6.2 Orientaci√≥n vocacional y proyecto de vida": {
        pregunta: "En el est√°ndar 6.2, ¬øqu√© descriptor es correcto?",
        opciones: [
            "Los estudiantes se informan solos sobre opciones postsecundarias.",
            "La escuela organiza acciones sistem√°ticas de orientaci√≥n vocacional y proyecto de vida por nivel.",
            "Solo se aplica un test vocacional en 4¬∞ medio.",
            "La orientaci√≥n se limita a entregar tr√≠pticos informativos."
        ],
        ok: 1
    },
    "12.2 Gesti√≥n de recursos did√°cticos y tecnol√≥gicos": {
        pregunta: "¬øQu√© evidencia se asocia al est√°ndar 12.2?",
        opciones: [
            "Adquirir recursos tecnol√≥gicos y mantenerlos guardados.",
            "Permitir que los estudiantes usen dispositivos solo en recreos.",
            "Planificar el uso pedag√≥gico de recursos tecnol√≥gicos en las clases y monitorear su impacto.",
            "Dejar la gesti√≥n de recursos a cargo del inspector."
        ],
        ok: 2
    },
    "Gesti√≥n financiera y administrativa": {
        pregunta: "Un descriptor coherente con Gesti√≥n financiera y administrativa es:",
        opciones: [
            "Ejecutar el presupuesto sin considerar el PME.",
            "Subejecutar permanentemente los recursos por falta de planificaci√≥n.",
            "Planificar y ejecutar los recursos de manera oportuna, alineada al PME y rendida seg√∫n normativa.",
            "Gastar los recursos solo al final del a√±o."
        ],
        ok: 2
    },
    "10.1 Perfiles, selecci√≥n y asignaci√≥n de funciones": {
        pregunta: "¬øQu√© pr√°ctica responde al est√°ndar 10.1?",
        opciones: [
            "Asignar cualquier profesor a cualquier asignatura por disponibilidad.",
            "Definir perfiles de cargo y asignar funciones seg√∫n competencias y formaci√≥n.",
            "Contratar por recomendaci√≥n informal.",
            "Cambiar docentes de asignatura cada mes."
        ],
        ok: 1
    },
    "10.3 Desarrollo profesional y capacitaci√≥n": {
        pregunta: "¬øCu√°l es un descriptor de desarrollo profesional (10.3)?",
        opciones: [
            "No planificar capacitaciones.",
            "Ofrecer talleres sin relaci√≥n con necesidades detectadas.",
            "Dise√±ar un plan de formaci√≥n continua basado en brechas y resultados.",
            "Enviar a todos al mismo curso sin diagn√≥stico previo."
        ],
        ok: 2
    },
    "12.1 Infraestructura, equipamiento y seguridad": {
        pregunta: "Un descriptor clave del est√°ndar 12.1 ser√≠a:",
        opciones: [
            "Postergar mantenciones hasta que los espacios sean inutilizables.",
            "Gestionar mantenci√≥n y mejoramiento de espacios para garantizar condiciones seguras y dignas.",
            "Solo pintar la fachada para visitas oficiales.",
            "Responsabilizar a estudiantes por los da√±os estructurales."
        ],
        ok: 1
    }
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ESTADO DEL JUEGO Y NIVELES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let selectedDimension = "";
let sessionChallenges = [];
let currentStep = 0;
let score = 0;
let isAnswered = false;
let playerLevel = 1; // 1 a 4

/* Utilidad: barajar arreglos */
function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GENERACI√ìN DE DESAF√çOS POR NIVEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function generateSession(pool) {
    const shuffled = shuffleArray(pool);
    const selected = shuffled.slice(0, 5);
    return selected.map(c => buildChallengeByLevel(c));
}

function buildChallengeByLevel(caseData) {
    // Nivel 1: tal como en el banco base
    if (playerLevel === 1) {
        return { ...caseData };
    }

    // Nivel 2: discriminar entre est√°ndares similares de la MISMA dimensi√≥n
    if (playerLevel === 2) {
        return buildDiscriminationLevel(caseData);
    }

    // Nivel 3: trabajar a nivel de descriptor t√©cnico del est√°ndar (si existe)
    if (playerLevel === 3) {
        const descEntry = STANDARD_DESCRIPTORS[caseData.standardKey];
        if (descEntry) {
            return buildDescriptorLevel(caseData, descEntry);
        } else {
            // Si no tenemos descriptor definido, caemos a nivel 2
            return buildDiscriminationLevel(caseData);
        }
    }

    // Nivel 4: caso h√≠brido, priorizaci√≥n estrat√©gica
    if (playerLevel === 4) {
        return buildHybridLevel(caseData);
    }

    return { ...caseData };
}

function buildDiscriminationLevel(c) {
    // Tomar otros est√°ndares correctos de la misma dimensi√≥n como distractores
    const dimCases = MASTER_BANK[selectedDimension] || [];
    let distractors = dimCases
        .map(cc => cc.standardKey)
        .filter(sk => sk !== c.standardKey);

    if (distractors.length < 3) {
        distractors = distractors.concat(distractors); // redundancia si hay pocos
    }
    distractors = shuffleArray(distractors).slice(0, 3);

    const opciones = shuffleArray([...distractors, c.standardKey]);

    return {
        escuela: c.escuela,
        problema: c.problema,
        pregunta: c.pregunta + " (Todas parecen cercanas, selecciona la opci√≥n M√ÅS precisa seg√∫n el EID).",
        opciones,
        ok: opciones.indexOf(c.standardKey),
        feedback: c.feedback + " En este nivel se espera que distingas entre est√°ndares muy pr√≥ximos."
    };
}

function buildDescriptorLevel(c, descEntry) {
    return {
        escuela: c.escuela,
        problema: c.problema,
        pregunta: descEntry.pregunta,
        opciones: descEntry.opciones,
        ok: descEntry.ok,
        feedback: c.feedback + " Adem√°s, este descriptor concreta la pr√°ctica que deber√≠as observar en terreno."
    };
}

function buildHybridLevel(c) {
    // Sacamos distractores de TODAS las dimensiones para forzar priorizaci√≥n
    const allCases = Object.values(MASTER_BANK).flat();
    let candidates = allCases
        .map(x => x.standardKey)
        .filter(sk => sk !== c.standardKey);

    candidates = shuffleArray(candidates).slice(0, 3);
    const opciones = shuffleArray([...candidates, c.standardKey]);

    return {
        escuela: c.escuela,
        problema: c.problema + " Adem√°s, la direcci√≥n reconoce m√∫ltiples problemas y pide priorizar por d√≥nde comenzar.",
        pregunta: "Varias dimensiones parecen afectadas. Seg√∫n el EID, ¬øcu√°l es el est√°ndar PRIORITARIO a intervenir?",
        opciones,
        ok: opciones.indexOf(c.standardKey),
        feedback: c.feedback + " En nivel experto, la pericia consiste en identificar la causa ra√≠z y priorizar el est√°ndar correcto."
    };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   L√ìGICA DE INTERFAZ Y FLUJO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function updateNav(step) {
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    const el = document.getElementById(`nav-${step}`);
    if (el) el.classList.add('active');
}

function updateLevelDisplay() {
    const el = document.getElementById('display-level');
    if (el) el.innerText = `Nivel ${playerLevel}`;
}

function selectDimension(dim) {
    selectedDimension = dim;
    const pool = MASTER_BANK[dim] || [];

    sessionChallenges = generateSession(pool);
    
    document.getElementById('screen-intro').classList.add('hidden');
    document.getElementById('screen-game').classList.remove('hidden');
    document.getElementById('display-dim').innerText = dim.toUpperCase();
    updateLevelDisplay();
    
    updateNav(1);
    initGame();
}

function initGame() {
    score = 0;
    currentStep = 0;
    renderProgress();
    loadChallenge();
}

function renderProgress() {
    const container = document.getElementById('progress-dots');
    container.innerHTML = '';
    for (let i = 0; i < sessionChallenges.length; i++) {
        const dot = document.createElement('div');
        dot.className = `w-3 h-3 rounded-full border border-white/20 transition-colors duration-500 ${i < currentStep ? 'bg-green-400' : 'bg-slate-800'}`;
        container.appendChild(dot);
    }
}

function loadChallenge() {
    if (currentStep >= sessionChallenges.length) {
        finishMission();
        return;
    }

    isAnswered = false;
    const c = sessionChallenges[currentStep];
    const container = document.getElementById('challenge-container');
    updateNav(2);

    container.innerHTML = `
        <div class="glass p-8 border-l-4 border-blue-500 shadow-2xl fade-in">
            <span class="text-[10px] font-mono text-blue-400 uppercase tracking-widest">Expediente #${currentStep + 1} de ${sessionChallenges.length}</span>
            <h3 class="text-xl font-bold mt-2 text-white">${c.escuela}</h3>
            <p class="text-slate-400 mt-4 leading-relaxed">"${c.problema}"</p>
        </div>

        <div class="space-y-4 fade-in" style="animation-delay: 0.1s">
            <h4 class="text-lg font-bold text-neon mb-4">${c.pregunta}</h4>
            <div class="grid grid-cols-1 gap-3" id="options-grid">
                ${c.opciones.map((opt, i) => `
                    <button onclick="checkAnswer(${i}, this)" class="opt-card p-5 rounded-xl text-left group w-full">
                        <span class="w-8 h-8 rounded bg-slate-800 flex-shrink-0 flex items-center justify-center font-mono text-xs group-hover:bg-blue-600 transition-colors">${String.fromCharCode(65 + i)}</span>
                        <span class="text-sm font-medium text-slate-300 group-hover:text-white">${opt}</span>
                    </button>
                `).join('')}
            </div>
        </div>
    `;
}

function checkAnswer(idx, btnElement) {
    if (isAnswered) return;
    isAnswered = true;

    const challenge = sessionChallenges[currentStep];
    const btns = document.querySelectorAll('.opt-card');
    
    btns.forEach(btn => btn.classList.add('disabled'));

    if (idx === challenge.ok) {
        btnElement.classList.add('correct');
        score++;
        showFeedback("¬°Correcto! " + challenge.feedback, true);
    } else {
        btnElement.classList.add('wrong');
        if (btns[challenge.ok]) {
            btns[challenge.ok].classList.add('correct');
        }
        showFeedback("Hallazgo incorrecto. " + challenge.feedback, false);
    }
}

function showFeedback(text, isOk) {
    const container = document.getElementById('challenge-container');
    const fb = document.createElement('div');
    fb.className = `glass p-6 mt-6 border-l-4 ${isOk ? 'border-green-500' : 'border-red-500'} fade-in`;
    fb.innerHTML = `
        <p class="text-sm italic text-slate-200">"${text}"</p>
        <button onclick="nextStep()" class="mt-6 bg-slate-800 hover:bg-slate-700 px-6 py-2 rounded-lg text-xs font-bold uppercase tracking-widest transition-all text-white">
            Siguiente Caso <i class="fa-solid fa-chevron-right ml-2"></i>
        </button>
    `;
    container.appendChild(fb);
    fb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function nextStep() {
    currentStep++;
    renderProgress();
    loadChallenge();
}

function finishMission() {
    document.getElementById('screen-game').classList.add('hidden');
    document.getElementById('screen-debrief').classList.remove('hidden');
    updateNav(3);

    const feedbackEl = document.getElementById('pericia-feedback');
    const statusEl = document.getElementById('mission-status');

    const total = sessionChallenges.length;
    const approvalThreshold = Math.ceil(total * 0.8); // 80%
    const prevLevel = playerLevel;

    if (score >= approvalThreshold) {
        statusEl.innerText = "√âXITO TOTAL";
        statusEl.className = "text-green-400";
        playerLevel = Math.min(playerLevel + 1, 4);
        feedbackEl.innerText = `Has resuelto ${score} de ${total} casos correctamente en nivel ${prevLevel}. Tu pericia en "${selectedDimension}" progresa al nivel ${playerLevel}. Puedes abordar casos con mayor complejidad t√©cnica del EID.`;
    } else {
        statusEl.innerText = "NIVEL EN DESARROLLO";
        statusEl.className = "text-orange-400";
        feedbackEl.innerText = `Has obtenido ${score} de ${total} en nivel ${prevLevel}. Se recomienda revisar los descriptores de los Est√°ndares Indicativos de la dimensi√≥n "${selectedDimension}" antes de pasar a niveles superiores. Mantendr√°s tu nivel actual (${playerLevel}).`;
    }

    updateLevelDisplay();
}

function resetGame() {
    document.getElementById('screen-debrief').classList.add('hidden');
    document.getElementById('screen-intro').classList.remove('hidden');
    
    updateNav(0);
    
    selectedDimension = "";
    sessionChallenges = [];
    currentStep = 0;
    score = 0;
    isAnswered = false;
    
    document.getElementById('progress-dots').innerHTML = '';
    document.getElementById('challenge-container').innerHTML = '';
}

/* Fondo din√°mico (Canvas) */
(()=>{
  const c = document.getElementById('cvs'), ctx = c.getContext('2d');
  let W, H, pts = [];
  const resize = () => { W = c.width = innerWidth; H = c.height = innerHeight; };
  resize(); addEventListener('resize', resize);
  for(let i=0; i<40; i++) pts.push({x: Math.random()*100, y: Math.random()*100, vx: (Math.random()-.5)*.02, vy: (Math.random()-.5)*.02, r: Math.random()*1.2});
  const draw = () => {
    ctx.clearRect(0, 0, W, H);
    pts.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      if(p.x < 0) p.x = 100; if(p.x > 100) p.x = 0;
      if(p.y < 0) p.y = 100; if(p.y > 100) p.y = 0;
      ctx.beginPath(); ctx.arc(p.x/100*W, p.y/100*H, p.r, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(0, 212, 255, 0.2)'; ctx.fill();
    });
    requestAnimationFrame(draw);
  };
  draw();
})();
</script>
</body>
</html>